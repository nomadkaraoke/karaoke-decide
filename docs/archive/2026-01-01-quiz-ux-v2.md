# Quiz UX V2: Inclusive Genres + Spotify Metadata ETL

**Date:** 2026-01-01
**Status:** Code Complete (ETL pending execution)

## Summary

Major quiz UX improvements focused on inclusivity and better user experience:
1. Expanded genre list from 7 to 15 genres
2. Genre-filtered artist selection
3. "Show More Artists" behavior (append vs replace)
4. Genre pills on artist cards
5. Example artists shown for each decade
6. Single completion CTA (removed confusing "View My Songs" option)

Also created comprehensive Spotify metadata ETL script for future features.

## Problem

Original quiz had several UX issues:
- Limited genre selection (7 genres) missed diverse music tastes
- Artist selection didn't filter by selected genres
- "Show Different Artists" lost user selections
- Decade selection provided no context for what each era meant
- Two completion CTAs ("View Recommendations" vs "View My Songs") confused users

Additionally, original Spotify ETL only extracted basic track data, missing valuable metadata like genres and audio features.

## Solution

### Quiz UX Improvements

| Feature | Before | After |
|---------|--------|-------|
| Genres | 7 (Pop, Rock, Country, etc.) | 15 (+ Electronic, Metal, Jazz, Latin, K-Pop, Indie, Broadway, Reggae) |
| Artist filtering | Random artists | Filtered by selected genres |
| Load more | "Show Different Artists" (replaces all) | "Show More Artists" (appends, keeps selections) |
| Artist cards | Name + songs only | + Genre pills (up to 3) |
| Decades | Just buttons | Buttons + 3 example artists each |
| Completion | 2 buttons | 1 button ("View Recommendations") |

### Backend API Changes

**New endpoint:**
- `GET /api/quiz/decade-artists` - Returns example artists per decade

**Updated endpoint:**
- `GET /api/quiz/artists` - New query parameters:
  - `genres` (list) - Filter by genre IDs
  - `exclude` (list) - Exclude artist names (for pagination)
- Response now includes `genres: string[]` field

### Spotify Metadata ETL

New script: `scripts/spotify_complete_etl.py`

**Tables to extract (once run on GCE VM):**
| BigQuery Table | Description | Est. Rows |
|----------------|-------------|-----------|
| `spotify_artists` | Artist metadata | ~500K |
| `spotify_artist_genres` | Artist-genre associations | ~2-3M |
| `spotify_albums` | Album metadata with release dates | ~50M |
| `spotify_tracks_full` | Full track metadata | ~256M |
| `spotify_track_artists` | Track-artist junction | ~300M |
| `spotify_audio_features` | Danceability, energy, tempo, etc. | ~200M |

**Audio features enable future features:**
- "High energy karaoke" filtering
- "Chill karaoke" filtering
- BPM-based song selection

## Files Changed

### Backend
- `backend/services/quiz_service.py` - Genre filtering, exclude logic, decade-artists
- `backend/api/routes/quiz.py` - New endpoint, updated parameters
- `karaoke_decide/core/models.py` - Added `genres` field to QuizArtist

### Frontend
- `frontend/src/app/quiz/page.tsx` - All quiz UI changes
- `frontend/src/components/QuizArtistCard.tsx` - Genre pills
- `frontend/src/lib/api.ts` - Updated API client
- `frontend/e2e/quiz.spec.ts` - Updated tests

### New Scripts
- `scripts/spotify_complete_etl.py` - Complete Spotify metadata extraction

## Pending Manual Step

**ETL must be run manually on GCE VM:**
```bash
# On VM with Spotify dump files downloaded
python3 scripts/spotify_complete_etl.py
```

Until ETL runs, genre filtering falls back to simple query (no genre data shown).

## Testing

- TypeScript compilation: Pass
- Unit tests: 135 passed
- E2E tests: Updated for new button IDs

## Design Decisions

1. **15 genres chosen for inclusivity** - Not trying to be comprehensive, but covering major global music styles including K-Pop, Latin, Jazz standards, Broadway
2. **Append vs replace for artists** - Users investing time in selections shouldn't lose them
3. **Single CTA** - "View My Songs" was confusing; quiz is about discovery, not library management
4. **Hardcoded decade artists** - Provides reliable UX even before ETL completes

## Future Improvements

Once ETL completes:
- Genre pills populated from real Spotify data
- Decade artists could be dynamic (from album release dates)
- Audio features enable energy-based filtering
